# Общая информация

STACK: **`Django`**, **`Django-Channels`**, **`Redis`**, **`PostgreSQL`**, **`WebSockets`**

Приложение делает одну простую вещь: реализует авторизацию через телеграм бота.

## Запуск  

### Предварительные действия  
#### Запуск бота  
Перед запуском приложения стоит запустить телеграм бота, через которого производится авторизация.  
#### Переменные окружения  
Перед запуском приложения необходимо определить следующие переменные окружения:  
- **SECRET_KEY** - секретный ключ  
- **POSTGRES_DB** - название базы данных в PostgreSQL  
- **POSTGRES_USER** - имя пользователя, который имеет доступ к базе данных  
- **POSTGRES_PASSWORD** - пароль пользователя базы данных в PostgreSQL  
- **POSTGRES_HOST** - адрес работающей базы данных PostgreSQL  
- **REDIS_HOST** - адрес работающеей базы данных Redis  
- **TG_URL** - URL бота  
  
### Варианты запуска  
#### Обычный запуск  
Для обычного запуска достаточно ввести последовательность следующих команд в директории проекта:  
1. `pip install -r requirements.txt`  
2. `python manage.py makemigrations`  
3. `python manage.py migrate`  
4. `python manage.py runserver`  
#### Запуск через docker  
Для запуска через docker понадобится лишь создать в директории проекта файл переменных окружения docker_proj.env и прописать там все необходимые переменные окружения + 2 переменные окружения:   
- PYTHONDONTWRITEBYTECODE=1    
- PYTHONUNBUFFERED=1  
  
Далее все запускается командой `docker-compose up` в директории проекта  
  
  
# Пояснение реализации  
  
## Непрерывная связь с телеграм ботом  
  
Непрерывная связь Django приложения с телеграм ботом имитируется с помощью библиотеки **channels**, которая работает с  технологией **WebSocket**, и **JS** скриптов. После ввода команды `/start`  телеграм бот отправляет **POST** запрос Django приложению, инициируя автоматическую авторизацию и перезагрузку страницы с помощью **JS** скрипта, используя веб сокет.  
  
## Авторизация  
Так как в условии сказано использовать стандартные механизмы авторизации Django, а для авторизации через телеграм пароль как таковой не нужен в принципе, вместо переписывания модели пользователя была задействована заменяемая альтернатива.  
  
### Альтернатива кастомной модели User  
Каждый раз при авторизации через телеграм бота, если пользователь уже авторизовывался, его пароль сбрасывается на условную строку, которая является заглушкой, генерируемую случайно. В итоге пользователь авторизуется под никнеймом в телеграм боте и паролем, который генерируется каждый раз при авторизации.